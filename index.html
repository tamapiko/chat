<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>そろばん</title>
    <style>
        .abacus {
            display: grid;
            grid-template-rows: 100px 5px 100px;
            gap: 5px;
            justify-content: center;
            align-items: center;
            background: #3e3e3e;
            padding: 10px;
            border: 10px solid #3e3e3e;
            border-radius: 5px;
            width: fit-content;
            margin: 0 auto;
            margin-top: 50px;
        }
        .bead {
            width: 59.66668px;
            height: 39.5px;
            background: url('珠.svg') no-repeat center center;
            background-size: contain;
            position: relative;
            cursor: pointer;
        }
        .rod {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        .bar {
            width: 100%;
            height: 5px;
            background: black;
            grid-column: span 1;
        }
        #controls {
            text-align: center;
            margin-top: 20px;
        }
        #controls input {
            width: 50px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <label for="columns">桁数を入力してください（5〜27）:</label>
        <input type="number" id="columns" name="columns" min="5" max="27" value="13">
        <button onclick="generateAbacus()">生成</button>
    </div>
    <div class="abacus" id="abacus"></div>

    <script>
        function generateAbacus() {
            const abacus = document.getElementById('abacus');
            const columns = parseInt(document.getElementById('columns').value);
            abacus.innerHTML = ''; // 以前の内容をクリア

            // 上部の珠
            for (let i = 0; i < columns; i++) {
                const rod = document.createElement('div');
                rod.className = 'rod';
                const bead = document.createElement('div');
                bead.className = 'bead';
                bead.setAttribute('data-position', 'up');
                rod.appendChild(bead);
                abacus.appendChild(rod);
            }

            // 中央のバー
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.gridColumn = `span ${columns}`;
            abacus.appendChild(bar);

            // 下部の珠
            for (let i = 0; i < columns; i++) {
                const rod = document.createElement('div');
                rod.className = 'rod';
                for (let j = 0; j < 4; j++) {
                    const bead = document.createElement('div');
                    bead.className = 'bead';
                    bead.setAttribute('data-position', 'down');
                    rod.appendChild(bead);
                }
                abacus.appendChild(rod);
            }

            // スワイプイベントの追加
            const beads = document.querySelectorAll('.bead');
            beads.forEach(bead => {
                bead.addEventListener('touchstart', handleTouchStart, false);
                bead.addEventListener('touchmove', handleTouchMove, false);
            });
        }

        let xDown = null;
        let yDown = null;

        function getTouches(evt) {
            return evt.touches || evt.originalEvent.touches;
        }

        function handleTouchStart(evt) {
            const firstTouch = getTouches(evt)[0];
            xDown = firstTouch.clientX;
            yDown = firstTouch.clientY;
        }

        function handleTouchMove(evt) {
            if (!xDown || !yDown) {
                return;
            }

            const xUp = evt.touches[0].clientX;
            const yUp = evt.touches[0].clientY;

            const xDiff = xDown - xUp;
            const yDiff = yDown - yUp;

            if (Math.abs(xDiff) > Math.abs(yDiff)) {
                // 横方向のスワイプ（無視）
                return;
            } else {
                if (yDiff > 0) {
                    /* 上にスワイプした場合 */
                    moveBead(evt.target, 'up');
                } else {
                    /* 下にスワイプした場合 */
                    moveBead(evt.target, 'down');
                }
            }
            xDown = null;
            yDown = null;
        }

        function moveBead(bead, direction) {
            const currentPosition = bead.getAttribute('data-position');
            if (direction === 'up' && currentPosition === 'down') {
                bead.style.transform = 'translateY(-50px)';
                bead.setAttribute('data-position', 'up');
            } else if (direction === 'down' && currentPosition === 'up') {
                bead.style.transform = 'translateY(50px)';
                bead.setAttribute('data-position', 'down');
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            generateAbacus();
        });
    </script>
</body>
</html>
