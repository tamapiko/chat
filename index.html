<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スワイプで操作できるそろばん</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }

        .controls {
            margin: 20px;
        }

        .abacus {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .rod {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 10px;
            position: relative;
            height: 200px;
            width: 50px;
        }

        .bead {
            width: 40px;
            height: 40px;
            background-color: #ffcc00;
            border-radius: 50%;
            margin: 5px;
            cursor: pointer;
            position: absolute;
            touch-action: none;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="rod-count">ロッドの数:</label>
        <select id="rod-count">
            <option value="13">13桁</option>
            <option value="14">14桁</option>
            <option value="15">15桁</option>
            <option value="16">16桁</option>
            <option value="17">17桁</option>
            <option value="18">18桁</option>
            <option value="19">19桁</option>
            <option value="20">20桁</option>
            <option value="21">21桁</option>
            <option value="22">22桁</option>
            <option value="23">23桁</option>
            <option value="24">24桁</option>
            <option value="25">25桁</option>
            <option value="26">26桁</option>
            <option value="27">27桁</option>
        </select>
        <button id="generate-abacus">生成</button>
    </div>
    <div class="abacus" id="abacus"></div>
    <script>
        document.getElementById('generate-abacus').addEventListener('click', () => {
            const rodCount = document.getElementById('rod-count').value;
            const abacus = document.getElementById('abacus');
            abacus.innerHTML = ''; // 既存のそろばんをクリア

            for (let i = 0; i < rodCount; i++) {
                const rod = document.createElement('div');
                rod.className = 'rod';

                for (let j = 0; j < 5; j++) { // 各ロッドに5つの珠を追加
                    const bead = document.createElement('div');
                    bead.className = 'bead';
                    bead.dataset.index = j;
                    rod.appendChild(bead);
                }

                abacus.appendChild(rod);
            }

            // 珠のスワイプ操作を設定
            document.querySelectorAll('.bead').forEach(bead => {
                let startY;
                bead.addEventListener('touchstart', e => {
                    startY = e.touches[0].clientY;
                });

                bead.addEventListener('touchmove', e => {
                    const deltaY = e.touches[0].clientY - startY;
                    bead.style.transform = `translateY(${deltaY}px)`;
                });

                bead.addEventListener('touchend', e => {
                    const rod = bead.parentElement;
                    const rodHeight = rod.clientHeight;
                    const beadHeight = bead.clientHeight;
                    const rodTop = rod.getBoundingClientRect().top;
                    const beadTop = bead.getBoundingClientRect().top;

                    // そろばんの中央に近いかどうかを判断
                    if (beadTop + beadHeight / 2 < rodTop + rodHeight / 2) {
                        bead.style.transform = 'translateY(-50px)'; // 上に移動
                    } else {
                        bead.style.transform = 'translateY(50px)'; // 下に移動
                    }
                });
            });
        });
    </script>
</body>
</html>